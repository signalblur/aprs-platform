---
openapi: 3.0.3
info:
  title: APRS API
  version: v1
  description: Anomalous Phenomena Reporting System — read-only API for UAP sighting
    data.
  license:
    name: AGPL-3.0
    url: https://www.gnu.org/licenses/agpl-3.0.html
  contact:
    name: APRS on GitHub
    url: https://github.com/signalblur/aprs-platform
paths:
  "/api/v1/investigations":
    get:
      summary: Lists investigations with optional filters
      tags:
      - Investigations
      security:
      - api_key: []
      parameters:
      - name: status
        in: query
        required: false
        enum:
        - open
        - in_progress
        - closed_resolved
        - closed_unresolved
        - closed_inconclusive
        description: "Filter by investigation status:\n * `open` \n * `in_progress`
          \n * `closed_resolved` \n * `closed_unresolved` \n * `closed_inconclusive`
          \n "
        schema:
          type: string
      - name: priority
        in: query
        required: false
        enum:
        - low
        - medium
        - high
        - critical
        description: Filter by priority level
        schema:
          type: string
      - name: page
        in: query
        required: false
        description: 'Page number (default: 1)'
        schema:
          type: integer
      responses:
        '200':
          description: paginated investigations list
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      "$ref": "#/components/schemas/InvestigationSummary"
                  meta:
                    "$ref": "#/components/schemas/PaginationMeta"
                required:
                - data
                - meta
        '401':
          description: unauthorized — missing or invalid API key
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
  "/api/v1/investigations/{id}":
    get:
      summary: Retrieves a single investigation with associations
      tags:
      - Investigations
      security:
      - api_key: []
      parameters:
      - name: id
        in: path
        required: true
        description: Investigation ID
        schema:
          type: integer
      responses:
        '200':
          description: investigation detail (member view — excludes findings and notes)
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    "$ref": "#/components/schemas/InvestigationDetail"
                required:
                - data
        '401':
          description: unauthorized — missing or invalid API key
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '404':
          description: investigation not found
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
  "/api/v1/shapes":
    get:
      summary: Lists all UAP shape categories
      tags:
      - Shapes
      security:
      - api_key: []
      responses:
        '200':
          description: shapes retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      "$ref": "#/components/schemas/Shape"
                required:
                - data
        '401':
          description: unauthorized — missing or invalid API key
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
  "/api/v1/sightings":
    get:
      summary: Lists sightings with optional filters
      tags:
      - Sightings
      security:
      - api_key: []
      parameters:
      - name: status
        in: query
        required: false
        enum:
        - submitted
        - under_review
        - verified
        - rejected
        description: "Filter by sighting status:\n * `submitted` \n * `under_review`
          \n * `verified` \n * `rejected` \n "
        schema:
          type: string
      - name: shape_id
        in: query
        required: false
        description: Filter by shape ID
        schema:
          type: integer
      - name: q
        in: query
        required: false
        description: Full-text search on description (case-insensitive)
        schema:
          type: string
      - name: date_from
        in: query
        format: date
        required: false
        description: Filter sightings observed on or after this date (YYYY-MM-DD)
        schema:
          type: string
      - name: date_to
        in: query
        format: date
        required: false
        description: Filter sightings observed on or before this date (YYYY-MM-DD)
        schema:
          type: string
      - name: lat
        in: query
        format: double
        required: false
        description: Latitude for radius search (requires lng and radius)
        schema:
          type: number
      - name: lng
        in: query
        format: double
        required: false
        description: Longitude for radius search (requires lat and radius)
        schema:
          type: number
      - name: radius
        in: query
        required: false
        description: Search radius in meters (requires lat and lng)
        schema:
          type: number
      - name: page
        in: query
        required: false
        description: 'Page number (default: 1)'
        schema:
          type: integer
      responses:
        '200':
          description: paginated sightings list
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      "$ref": "#/components/schemas/SightingSummary"
                  meta:
                    "$ref": "#/components/schemas/PaginationMeta"
                required:
                - data
                - meta
        '401':
          description: unauthorized — missing or invalid API key
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
  "/api/v1/sightings/{id}":
    get:
      summary: Retrieves a single sighting with all associations
      tags:
      - Sightings
      security:
      - api_key: []
      parameters:
      - name: id
        in: path
        required: true
        description: Sighting ID
        schema:
          type: integer
      responses:
        '200':
          description: sighting detail (investigator view — includes witness contact_info)
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    "$ref": "#/components/schemas/SightingDetail"
                required:
                - data
        '401':
          description: unauthorized — missing or invalid API key
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '404':
          description: sighting not found
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
servers:
- url: "{protocol}://{host}"
  variables:
    protocol:
      default: https
      enum:
      - https
      - http
    host:
      default: localhost:3000
components:
  securitySchemes:
    api_key:
      type: apiKey
      name: X-Api-Key
      in: header
      description: API key for authentication. Obtain via user account.
  schemas:
    Location:
      type: object
      nullable: true
      properties:
        lat:
          type: number
          format: double
          description: Latitude (WGS 84)
        lng:
          type: number
          format: double
          description: Longitude (WGS 84)
      required:
      - lat
      - lng
    PaginationMeta:
      type: object
      properties:
        page:
          type: integer
          example: 1
        per_page:
          type: integer
          example: 20
        total:
          type: integer
          example: 42
        total_pages:
          type: integer
          example: 3
      required:
      - page
      - per_page
      - total
      - total_pages
    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          example: Unauthorized
      required:
      - error
    Shape:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
          example: Disc
        description:
          type: string
          nullable: true
          example: Flat disc-shaped object
      required:
      - id
      - name
    ShapeReference:
      type: object
      description: Abbreviated shape (id + name only), embedded in sighting responses.
      properties:
        id:
          type: integer
        name:
          type: string
          example: Triangle
      required:
      - id
      - name
    SightingSummary:
      type: object
      properties:
        id:
          type: integer
        description:
          type: string
        status:
          type: string
          enum:
          - submitted
          - under_review
          - verified
          - rejected
        shape:
          "$ref": "#/components/schemas/ShapeReference"
        location:
          "$ref": "#/components/schemas/Location"
        altitude_feet:
          type: number
          format: double
          nullable: true
        duration_seconds:
          type: integer
          nullable: true
        num_witnesses:
          type: integer
        visibility_conditions:
          type: string
          nullable: true
        weather_notes:
          type: string
          nullable: true
        media_source:
          type: string
          nullable: true
        observed_at:
          type: string
          format: date-time
        observed_timezone:
          type: string
          example: America/Denver
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
      - id
      - description
      - status
      - shape
      - observed_at
      - observed_timezone
      - created_at
      - updated_at
    PhysiologicalEffect:
      type: object
      properties:
        id:
          type: integer
        effect_type:
          type: string
        description:
          type: string
          nullable: true
        severity:
          type: string
          enum:
          - mild
          - moderate
          - severe
          nullable: true
        onset:
          type: string
          nullable: true
        duration:
          type: string
          nullable: true
      required:
      - id
      - effect_type
    PsychologicalEffect:
      type: object
      properties:
        id:
          type: integer
        effect_type:
          type: string
        description:
          type: string
          nullable: true
        severity:
          type: string
          enum:
          - mild
          - moderate
          - severe
          nullable: true
        onset:
          type: string
          nullable: true
        duration:
          type: string
          nullable: true
      required:
      - id
      - effect_type
    EquipmentEffect:
      type: object
      properties:
        id:
          type: integer
        equipment_type:
          type: string
        effect_type:
          type: string
        description:
          type: string
          nullable: true
      required:
      - id
      - equipment_type
      - effect_type
    EnvironmentalTrace:
      type: object
      properties:
        id:
          type: integer
        trace_type:
          type: string
        description:
          type: string
          nullable: true
        location:
          "$ref": "#/components/schemas/Location"
        measured_value:
          type: number
          format: double
          nullable: true
        measurement_unit:
          type: string
          nullable: true
      required:
      - id
      - trace_type
    Evidence:
      type: object
      properties:
        id:
          type: integer
        evidence_type:
          type: string
          enum:
          - photo
          - video
          - audio
          - document
          - other
        description:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
      required:
      - id
      - evidence_type
      - created_at
    Witness:
      type: object
      description: Witness record. The contact_info field is only included for users
        with investigator or admin role (PII gating).
      properties:
        id:
          type: integer
        name:
          type: string
          nullable: true
        statement:
          type: string
          nullable: true
        credibility_notes:
          type: string
          nullable: true
        contact_info:
          type: string
          nullable: true
          description: Only present for investigator/admin users.
      required:
      - id
    SightingDetail:
      allOf:
      - "$ref": "#/components/schemas/SightingSummary"
      - type: object
        properties:
          physiological_effects:
            type: array
            items:
              "$ref": "#/components/schemas/PhysiologicalEffect"
          psychological_effects:
            type: array
            items:
              "$ref": "#/components/schemas/PsychologicalEffect"
          equipment_effects:
            type: array
            items:
              "$ref": "#/components/schemas/EquipmentEffect"
          environmental_traces:
            type: array
            items:
              "$ref": "#/components/schemas/EnvironmentalTrace"
          evidences:
            type: array
            items:
              "$ref": "#/components/schemas/Evidence"
          witnesses:
            type: array
            items:
              "$ref": "#/components/schemas/Witness"
        required:
        - physiological_effects
        - psychological_effects
        - equipment_effects
        - environmental_traces
        - evidences
        - witnesses
    InvestigationSummary:
      type: object
      properties:
        id:
          type: integer
        case_number:
          type: string
          example: APRS-20260210-0001
        title:
          type: string
        status:
          type: string
          enum:
          - open
          - in_progress
          - closed_resolved
          - closed_unresolved
          - closed_inconclusive
        priority:
          type: string
          enum:
          - low
          - medium
          - high
          - critical
        classification:
          type: string
          nullable: true
          enum:
          - identified
          - unidentified
          - insufficient_data
          - hoax
        assigned_investigator_id:
          type: integer
          nullable: true
        sighting_count:
          type: integer
        opened_at:
          type: string
          format: date-time
        closed_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
      - id
      - case_number
      - title
      - status
      - priority
      - sighting_count
      - opened_at
      - created_at
      - updated_at
    InvestigationNote:
      type: object
      properties:
        id:
          type: integer
        note_type:
          type: string
          enum:
          - general
          - status_change
          - assignment
          - finding
        content:
          type: string
        author_id:
          type: integer
        created_at:
          type: string
          format: date-time
      required:
      - id
      - note_type
      - content
      - author_id
      - created_at
    InvestigationDetail:
      allOf:
      - "$ref": "#/components/schemas/InvestigationSummary"
      - type: object
        properties:
          description:
            type: string
            nullable: true
          sightings:
            type: array
            items:
              "$ref": "#/components/schemas/SightingSummary"
          findings:
            type: string
            nullable: true
            description: Only present for investigator/admin users.
          notes:
            type: array
            items:
              "$ref": "#/components/schemas/InvestigationNote"
            description: Only present for investigator/admin users.
        required:
        - description
        - sightings
