<% content_for(:title) { "API Keys â€” APRS" } %>

<div class="space-y-6">
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold text-aprs-text">API Keys</h1>
      <p class="text-sm text-aprs-text-muted mt-1">Manage your API keys for programmatic access</p>
    </div>
    <% if policy(ApiKey).create? %>
      <%= link_to "Create API Key", new_api_key_path,
            class: "px-4 py-2 text-sm font-medium rounded-lg bg-aprs-primary hover:bg-aprs-primary-hover text-white transition-colors" %>
    <% end %>
  </div>

  <% if @api_keys.any? %>
    <div class="bg-aprs-surface rounded-xl border border-aprs-border/30 overflow-hidden">
      <table class="w-full text-sm">
        <thead>
          <tr class="border-b border-aprs-border/30">
            <th class="text-left py-3 px-4 text-xs font-medium text-aprs-text-muted uppercase tracking-wider">Name</th>
            <th class="text-left py-3 px-4 text-xs font-medium text-aprs-text-muted uppercase tracking-wider">Prefix</th>
            <% if current_user.admin? %>
              <th class="text-left py-3 px-4 text-xs font-medium text-aprs-text-muted uppercase tracking-wider">Owner</th>
            <% end %>
            <th class="text-left py-3 px-4 text-xs font-medium text-aprs-text-muted uppercase tracking-wider">Status</th>
            <th class="text-left py-3 px-4 text-xs font-medium text-aprs-text-muted uppercase tracking-wider">Last Used</th>
            <th class="text-left py-3 px-4 text-xs font-medium text-aprs-text-muted uppercase tracking-wider">Created</th>
            <th class="text-right py-3 px-4 text-xs font-medium text-aprs-text-muted uppercase tracking-wider">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-aprs-border/20">
          <% @api_keys.each do |key| %>
            <tr>
              <td class="py-3 px-4 font-medium"><%= key.name %></td>
              <td class="py-3 px-4"><code class="text-xs bg-aprs-bg px-1.5 py-0.5 rounded"><%= key.key_prefix %>...</code></td>
              <% if current_user.admin? %>
                <td class="py-3 px-4 text-aprs-text-muted"><%= key.user.email %></td>
              <% end %>
              <td class="py-3 px-4">
                <% if key.usable? %>
                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-aprs-accent/10 text-aprs-accent">Active</span>
                <% elsif key.expired? %>
                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-aprs-warning/10 text-aprs-warning">Expired</span>
                <% else %>
                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-aprs-danger/10 text-aprs-danger">Inactive</span>
                <% end %>
              </td>
              <td class="py-3 px-4 text-aprs-text-muted"><%= key.last_used_at ? time_ago_in_words(key.last_used_at) + " ago" : "Never" %></td>
              <td class="py-3 px-4 text-aprs-text-muted"><%= key.created_at.strftime("%b %d, %Y") %></td>
              <td class="py-3 px-4 text-right space-x-2">
                <%= link_to "View", api_key_path(key), class: "text-xs text-aprs-primary hover:text-aprs-primary-hover transition-colors" %>
                <% if policy(key).destroy? %>
                  <%= button_to "Revoke", api_key_path(key), method: :delete,
                        class: "text-xs text-aprs-danger hover:text-aprs-danger/80 transition-colors cursor-pointer",
                        data: { turbo_confirm: "Revoke this API key? This cannot be undone." } %>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <div class="bg-aprs-surface rounded-xl border border-aprs-border/30 p-8 text-center">
      <p class="text-aprs-text-muted">No API keys yet. Create one to get started.</p>
    </div>
  <% end %>
</div>
