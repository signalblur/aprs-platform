<% content_for :title, "Memberships â€” APRS" %>

<div class="space-y-6">
  <div class="flex flex-wrap items-center justify-between gap-4">
    <h1 class="text-2xl font-bold">Memberships</h1>
  </div>

  <%# Filters %>
  <div class="bg-aprs-surface rounded-xl border border-aprs-border/30 p-4">
    <%= form_with url: memberships_path, method: :get, class: "flex flex-wrap gap-4 items-end", data: { turbo_frame: "_top" } do %>
      <div class="flex-1 min-w-[140px]">
        <label class="block text-xs font-medium text-aprs-text-muted uppercase tracking-wider mb-1">Tier</label>
        <%= select_tag :tier,
              options_for_select([["All tiers", ""], "free", "professional", "organization"], params[:tier]),
              class: "w-full rounded-lg border border-aprs-border/50 bg-aprs-bg text-sm px-3 py-2" %>
      </div>
      <div class="flex-1 min-w-[140px]">
        <label class="block text-xs font-medium text-aprs-text-muted uppercase tracking-wider mb-1">Status</label>
        <%= select_tag :active,
              options_for_select([["All", ""], ["Active", "true"], ["Inactive", "false"]], params[:active]),
              class: "w-full rounded-lg border border-aprs-border/50 bg-aprs-bg text-sm px-3 py-2" %>
      </div>
      <div>
        <%= submit_tag "Filter",
              class: "px-4 py-2 text-sm font-medium rounded-lg bg-aprs-primary/10 text-aprs-primary hover:bg-aprs-primary/20 border border-aprs-primary/20 transition-colors cursor-pointer" %>
      </div>
    <% end %>
  </div>

  <%# Memberships table %>
  <div class="bg-aprs-surface rounded-xl border border-aprs-border/30 overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead>
          <tr class="border-b border-aprs-border/30">
            <th class="text-left py-3 px-4 text-xs font-medium text-aprs-text-muted uppercase tracking-wider">User</th>
            <th class="text-left py-3 px-4 text-xs font-medium text-aprs-text-muted uppercase tracking-wider">Tier</th>
            <th class="text-left py-3 px-4 text-xs font-medium text-aprs-text-muted uppercase tracking-wider">Status</th>
            <th class="text-left py-3 px-4 text-xs font-medium text-aprs-text-muted uppercase tracking-wider">Granted By</th>
            <th class="text-left py-3 px-4 text-xs font-medium text-aprs-text-muted uppercase tracking-wider">Starts</th>
            <th class="text-left py-3 px-4 text-xs font-medium text-aprs-text-muted uppercase tracking-wider">Expires</th>
            <th class="text-left py-3 px-4 text-xs font-medium text-aprs-text-muted uppercase tracking-wider">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-aprs-border/20">
          <% @memberships.each do |membership| %>
            <tr class="hover:bg-aprs-surface-elevated/30 transition-colors">
              <td class="py-3 px-4 font-medium"><%= membership.user.email %></td>
              <td class="py-3 px-4">
                <% tier_colors = { "free" => "aprs-text-muted", "professional" => "aprs-primary", "organization" => "aprs-accent" } %>
                <% tcolor = tier_colors[membership.tier] || "aprs-text-muted" %>
                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-<%= tcolor %>/10 text-<%= tcolor %>">
                  <%= membership.tier.capitalize %>
                </span>
              </td>
              <td class="py-3 px-4">
                <% if membership.active? %>
                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-aprs-accent/10 text-aprs-accent">Active</span>
                <% else %>
                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-aprs-text-muted/10 text-aprs-text-muted">Inactive</span>
                <% end %>
              </td>
              <td class="py-3 px-4 text-aprs-text-muted"><%= membership.granted_by&.email || "System" %></td>
              <td class="py-3 px-4 text-aprs-text-muted text-xs">
                <time datetime="<%= membership.starts_at.iso8601 %>"><%= membership.starts_at.strftime("%b %d, %Y") %></time>
              </td>
              <td class="py-3 px-4 text-aprs-text-muted text-xs">
                <% if membership.expires_at %>
                  <time datetime="<%= membership.expires_at.iso8601 %>"><%= membership.expires_at.strftime("%b %d, %Y") %></time>
                <% else %>
                  Never
                <% end %>
              </td>
              <td class="py-3 px-4">
                <%= link_to "View", membership_path(membership),
                      class: "text-aprs-primary hover:text-aprs-primary-hover transition-colors text-xs" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <%# Pagination %>
  <div class="pagy">
    <%== pagy_nav(@pagy) if @pagy.pages > 1 %>
  </div>
</div>
