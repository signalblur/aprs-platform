<% content_for :title, "Investigations â€” APRS" %>

<div class="space-y-6">
  <div class="flex flex-wrap items-center justify-between gap-4">
    <h1 class="text-2xl font-bold">Investigations</h1>
    <% if policy(Investigation).create? %>
      <%= link_to "New Investigation", new_investigation_path,
            class: "px-4 py-2 text-sm font-medium rounded-lg bg-aprs-primary hover:bg-aprs-primary-hover text-white transition-colors" %>
    <% end %>
  </div>

  <%# Filters %>
  <div class="bg-aprs-surface rounded-xl border border-aprs-border/30 p-4">
    <%= form_with url: investigations_path, method: :get, class: "flex flex-wrap gap-4 items-end", data: { turbo_frame: "_top" } do %>
      <div class="flex-1 min-w-[140px]">
        <label class="block text-xs font-medium text-aprs-text-muted uppercase tracking-wider mb-1">Status</label>
        <%= select_tag :status,
              options_for_select([["All statuses", ""], "open", "in_progress", "closed_resolved", "closed_unresolved", "closed_inconclusive"], params[:status]),
              class: "w-full rounded-lg border border-aprs-border/50 bg-aprs-bg text-sm px-3 py-2" %>
      </div>
      <div class="flex-1 min-w-[140px]">
        <label class="block text-xs font-medium text-aprs-text-muted uppercase tracking-wider mb-1">Priority</label>
        <%= select_tag :priority,
              options_for_select([["All priorities", ""], "low", "medium", "high", "critical"], params[:priority]),
              class: "w-full rounded-lg border border-aprs-border/50 bg-aprs-bg text-sm px-3 py-2" %>
      </div>
      <div>
        <%= submit_tag "Filter",
              class: "px-4 py-2 text-sm font-medium rounded-lg bg-aprs-primary/10 text-aprs-primary hover:bg-aprs-primary/20 border border-aprs-primary/20 transition-colors cursor-pointer" %>
      </div>
    <% end %>
  </div>

  <%# Investigations table %>
  <div class="bg-aprs-surface rounded-xl border border-aprs-border/30 overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead>
          <tr class="border-b border-aprs-border/30">
            <th class="text-left py-3 px-4 text-xs font-medium text-aprs-text-muted uppercase tracking-wider">Case #</th>
            <th class="text-left py-3 px-4 text-xs font-medium text-aprs-text-muted uppercase tracking-wider">Title</th>
            <th class="text-left py-3 px-4 text-xs font-medium text-aprs-text-muted uppercase tracking-wider">Status</th>
            <th class="text-left py-3 px-4 text-xs font-medium text-aprs-text-muted uppercase tracking-wider">Priority</th>
            <th class="text-left py-3 px-4 text-xs font-medium text-aprs-text-muted uppercase tracking-wider">Assigned To</th>
            <th class="text-left py-3 px-4 text-xs font-medium text-aprs-text-muted uppercase tracking-wider">Opened</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-aprs-border/20">
          <% @investigations.each do |investigation| %>
            <tr class="hover:bg-aprs-surface-elevated/30 transition-colors">
              <td class="py-3 px-4 font-mono text-xs">
                <%= link_to investigation.case_number, investigation_path(investigation),
                      class: "text-aprs-primary hover:text-aprs-primary-hover transition-colors" %>
              </td>
              <td class="py-3 px-4 font-medium"><%= investigation.title.truncate(60) %></td>
              <td class="py-3 px-4">
                <% status_colors = { "open" => "aprs-accent", "in_progress" => "aprs-primary", "closed_resolved" => "aprs-accent", "closed_unresolved" => "aprs-warning", "closed_inconclusive" => "aprs-text-muted" } %>
                <% color = status_colors[investigation.status] || "aprs-text-muted" %>
                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-<%= color %>/10 text-<%= color %>">
                  <%= investigation.status.humanize %>
                </span>
              </td>
              <td class="py-3 px-4">
                <% priority_colors = { "low" => "aprs-text-muted", "medium" => "aprs-primary", "high" => "aprs-warning", "critical" => "aprs-danger" } %>
                <% pcolor = priority_colors[investigation.priority] || "aprs-text-muted" %>
                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-<%= pcolor %>/10 text-<%= pcolor %>">
                  <%= investigation.priority.capitalize %>
                </span>
              </td>
              <td class="py-3 px-4 text-aprs-text-muted"><%= investigation.assigned_investigator&.email || "Unassigned" %></td>
              <td class="py-3 px-4 text-aprs-text-muted text-xs">
                <time datetime="<%= investigation.opened_at.iso8601 %>"><%= investigation.opened_at.strftime("%b %d, %Y") %></time>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <%# Pagination %>
  <div class="pagy">
    <%== pagy_nav(@pagy) if @pagy.pages > 1 %>
  </div>
</div>
